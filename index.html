<script>
const params = new URLSearchParams(window.location.search);
const codGym = params.get("cod_gym");

const info = document.getElementById("info");
const btn = document.getElementById("btn");
const input = document.getElementById("codigo");
const msg = document.getElementById("msg");

if (!codGym) {
  info.innerText = "Gym no identificado";
} else {
  const SHEET_ID = "1Xgy4knXFneFKBVGwXveUoHdiQIeV8i_G1J8CwMbyxBo";
  const query = encodeURIComponent(
    `select B, F, G where A='${codGym}'`
  );

  const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tq=${query}`;

  fetch(url)
    .then(res => res.text())
    .then(text => {
      const jsonText = text.substring(
        text.indexOf("{"),
        text.lastIndexOf("}") + 1
      );
      const data = JSON.parse(jsonText);

      if (!data.table.rows.length) {
        info.innerText = "Gym no identificado";
        return;
      }

      const row = data.table.rows[0].c;

      info.innerHTML = `
        Vas a registrar tu asistencia en<br><br>
        <strong>${row[0].v}</strong><br><br>
        Precio normal por clase: $${row[1].v}<br>
        Precio preferencial APP: $${row[2].v}
      `;
    })
    .catch(() => {
      info.innerText = "Error cargando información";
    });
}

input.addEventListener("input", () => {
  btn.disabled = !/^\d{10}$/.test(input.value);
});

btn.addEventListener("click", () => {
  msg.innerText = "✔️ Asistencia registrada (demo)";
});
</script>
